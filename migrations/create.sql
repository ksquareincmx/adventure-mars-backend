CREATE TABLE IF NOT EXISTS `unit` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) DEFAULT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `quest` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) DEFAULT NULL, `published` TINYINT(1) NOT NULL DEFAULT false, `paused` TINYINT(1) NOT NULL DEFAULT false, `startTime` DATETIME DEFAULT NULL, `endTime` DATETIME DEFAULT NULL, `timeLimit` INTEGER DEFAULT NULL, `unitId` INTEGER, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (`unitId`) REFERENCES `unit` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `user` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) DEFAULT NULL, `email` VARCHAR(255) NOT NULL UNIQUE, `password` VARCHAR(255) NOT NULL, `role` ENUM('scout', 'leader', 'admin') NOT NULL DEFAULT 'scout', `currentLocation` POINT DEFAULT NULL, `unitId` INTEGER, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, UNIQUE `user_email_unique` (`email`), PRIMARY KEY (`id`), FOREIGN KEY (`unitId`) REFERENCES `unit` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `completedquest` (`id` INTEGER NOT NULL auto_increment , `questId` INTEGER, `userId` INTEGER, `time` DATETIME NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (`questId`) REFERENCES `quest` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`userId`) REFERENCES `user` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `item` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) DEFAULT NULL, `description` VARCHAR(255) DEFAULT NULL, `model3d` VARCHAR(255) DEFAULT NULL, `preview` VARCHAR(255) DEFAULT NULL, `type` ENUM('private', 'public') NOT NULL DEFAULT 'private', `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `iteminstance` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) DEFAULT NULL, `description` VARCHAR(255) DEFAULT NULL, `itemId` INTEGER, `questId` INTEGER, `unitId` INTEGER, `location` POINT DEFAULT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (`itemId`) REFERENCES `item` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`questId`) REFERENCES `quest` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`unitId`) REFERENCES `unit` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `founditem` (`id` INTEGER NOT NULL auto_increment , `itemInstanceId` INTEGER, `questId` INTEGER, `userId` INTEGER, `time` DATETIME NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (`itemInstanceId`) REFERENCES `iteminstance` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`questId`) REFERENCES `quest` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`userId`) REFERENCES `user` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `jwtblacklist` (`id` INTEGER NOT NULL auto_increment , `token` VARCHAR(512) NOT NULL, `expires` DATETIME DEFAULT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;
CREATE TABLE IF NOT EXISTS `questrun` (`id` INTEGER NOT NULL auto_increment , `questId` INTEGER, `userId` INTEGER, `startTime` DATETIME NOT NULL, `finishTime` DATETIME DEFAULT NULL, `completed` TINYINT(1) NOT NULL DEFAULT false, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`), FOREIGN KEY (`questId`) REFERENCES `quest` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE, FOREIGN KEY (`userId`) REFERENCES `user` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE) ENGINE=InnoDB;